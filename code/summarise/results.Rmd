---
title: European COVID-19 Scenario Modelling Hub
output:
  html_document:
    toc: true
    toc_depth: 5
    toc_float:
      collapsed: false
params:
  round: 0
---

```{r set-up, include=FALSE}
# Packages
library(here)
library(dplyr)
library(ggplot2)
library(purrr)
# Settings
knitr::opts_chunk$set(eval = TRUE, echo = FALSE, 
                      message = FALSE, warning = FALSE,
                      eval.after = "fig.cap")
source(here("code", "load", "scenarios.R"))
```

# Round `r params$round`

_Report created `r Sys.Date()`_

- Reporting projections originating `r scenarios[[paste0("round_", params$round)]][["origin_date"]]`

- See [full scenario details](`r paste0("https://github.com/covid19-forecast-hub-europe/covid19-scenario-hub-europe/wiki/Round-", params$round)`)

### Model availability

```{r models}
models_summary <- results %>%
  group_by(model) %>%
  summarise(Locations = n_distinct(location),
            scenarios = n_distinct(scenario_id),
            variables = n_distinct(target_variable),
            quantiles = "quantile" %in% type,
            max_date = max(target_end_date),
            Weeks = max(as.numeric(gsub(" wk", "", horizon))))

models_summary %>%
  select(Model = model, Locations, Weeks) %>%
  arrange(desc(Weeks)) %>%
  arrange(desc(Locations)) %>%
  knitr::kable(caption = "Available model results")

```


### Comparative projections {.tabset}

Results show the median (line) and 5-95% (shaded area) model projections across 4 scenarios and 32 locations.

#### By scenario {.tabset .tabset-pills}

##### Cases
![](`r here("reports", "round-0", "cross-scenario-cases.png")`)

##### Deaths
![](`r here("reports", "round-0", "cross-scenario-deaths.png")`)

#### By model {.tabset .tabset-pills}

##### Cases
![](`r here("reports", "round-0", "cross-model-cases.png")`)

##### Deaths
![](`r here("reports", "round-0", "cross-model-deaths.png")`)

### Individual model projections {.tabset}

```{r individual-models}
models_cases <- list.files(here('reports', 'round-0', 'inc case'))
models_cases <- gsub("\\.png", "", models_cases)
models_deaths <- list.files(here('reports', 'round-0', 'inc death'))
models_deaths <- gsub("\\.png", "", models_deaths)
```

```{r plot-individual-models, results = 'asis'}
for (model in unique(results$model)){
  cat("\n")
  cat("#### ", model, "{.tabset .tabset-pills}", "\n")
  
  if (model %in% models_cases) {
    cat("\n")
    cat("##### Cases \n")
    cat("\n")
    cat("![](", here('reports', 'round-0', 'inc case', 
                     paste0(model, '.png')), ")")
    cat("\n")
    }
  
  if (model %in% models_deaths) {
    cat("\n")
    cat("##### Deaths \n")
    cat("\n")
    cat("![](", here('reports', 'round-0', 'inc death', 
                     paste0(model, '.png')), ")")
    cat("\n")
  }
}
```


